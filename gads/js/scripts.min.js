!function(e){"function"==typeof define&&define.amd?define("scripts",e):e()}((function(){"use strict";jQuery((function(e){var t={STORAGE_KEY:"expert_review_likes:"+function(e){var t,i,n,a,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r=0,o="";do{t=(a=e.charCodeAt(r++)<<16|e.charCodeAt(r++)<<8|e.charCodeAt(r++))>>12&63,i=a>>6&63,n=63&a,o+=s.charAt(a>>18&63)+s.charAt(t)+s.charAt(i)+s.charAt(n)}while(r<e.length);switch(e.length%3){case 1:o=o.slice(0,-2)+"==";break;case 2:o=o.slice(0,-1)+"="}return o}(window.location.origin),_items:[],init:function(){var e={items:[]};return"undefined"!=typeof localStorage&&(e=localStorage.getItem(this.STORAGE_KEY))&&(e=JSON.parse(e),this._items=e.items),this},store:function(){if("undefined"!=typeof localStorage){var e={items:this._items};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}return this},like:function(e,t){return this._act(e,"like",t),this},dislike:function(e,t){return this._act(e,"dislike",t),this},remove:function(e,t){return this._act(e,"remove",t),this},_act:function(e,t,i){i=i||"posts";var n=this._items.filter((function(t){return t.hasOwnProperty("e")&&t.e!==i||t.id!==e}));"remove"!==t&&n.push({id:e,a:t,e:i}),this._items=n},isLiked:function(e,t){return this._check(e,"like",t)},isDisliked:function(e,t){return this._check(e,"dislike",t)},_check:function(e,t,i){i=i||"posts";var n=this._items.filter((function(t){return t.hasOwnProperty("e")?t.e===i&&t.id===e:"posts"===i&&t.id===e}));return!!n.length&&n[0].a===t}};t.init();var i=function(){e(".js-expert-review-likes-button").each((function(){var i=e(this);if(!i.data("init")){i.data("init",!0);var n=i.parents(".js-expert-review-likes-button-container"),a=i.parent().data(),s=n.data("entity_type"),r=null;"posts"===(s=s||"posts")?a.hasOwnProperty("name")?r=a.name:a.hasOwnProperty("post_id")&&(r=a.post_id):"comments"===s&&(r=n.data("comment_id")),r&&("like"===i.data("type")||"toggle"===i.data("type")?i.addClass(t.isLiked(r,s)?"voted":""):"dislike"===i.data("type")&&i.addClass(t.isDisliked(r,s)?"voted":""))}}))};function n(e){return e>1e6?(e/1e6).toFixed(1)+"&nbsp;m.":e>1e5?(e/1e3).toFixed(0)+"&nbsp;k.":e>1e3?(e/1e3).toFixed(1)+"&nbsp;k.":e}document.wpshopExpertReview_InitLikes=i,i(),e(document).on("journalx_load_post",(function(){setTimeout(i,100)})),e(document).on("click",".js-expert-review-likes-button",(function(i){i.preventDefault();var a=e(this),s=a.parents(".js-expert-review-likes-button-container"),r=s.data("entity_type");r=r||"posts";var o=null,l=a.data("type"),p="toggle"===l?"like":l,d=a.parent().data(),c=!1;if((!a.hasClass("voted")||"toggle"===l)&&("posts"===r?d.hasOwnProperty("name")?(o=d.name,c=!0):d.hasOwnProperty("post_id")&&(o=d.post_id):"comments"===r&&(o=s.data("comment_id")),o)){var u=!0;if("toggle"===l)t.isLiked(o,r)?(p="dislike",u=!1):t.isDisliked(o,r)&&(p="like",u=!1);else if("like"===l){if(t.isLiked(o,r))return;u=!t.isDisliked(o,r)}else if("dislike"===l){if(t.isDisliked(o,r))return;u=!t.isLiked(o,r)}var v={action:"expert_review_save_like",nonce:expert_review_ajax.nonce,is_named:c?1:0,entity:r,id:o,type:l,click_type:p,is_new:u?1:0};e.ajax({url:expert_review_ajax.url,type:"post",data:v,beforeSend:function(){a.addClass("loading"),a.prop("disabled",!0)}}).done((function(i){if(i.success){var a=c?'.js-expert-review-likes-button-container[data-name="'+o+'"]':'.js-expert-review-likes-button-container[data-post_id="'+o+'"]';"comments"===r&&(a='.js-expert-review-likes-button-container[data-comment_id="'+o+'"]'),e(document).find(a).each((function(){var t=e(this),a=t.find(".js-expert-review-likes-count"),s=t.find(".js-expert-review-dislikes-count");a.html(n(i.data.likes)),s.html(n(i.data.dislikes)),t.find(".js-expert-review-likes-button").removeClass("voted"),"dislike"!==p?t.find('.js-expert-review-likes-button[data-type!="dislike"]').addClass("voted"):"toggle"!==l&&t.find('.js-expert-review-likes-button[data-type="dislike"]').addClass("voted")})),"like"===l?t.like(o,r):"dislike"===l?t.dislike(o,r):"like"===p?t.like(o,r):t.remove(o,r),t.store(),c&&(e(document).find('.js-expert-review-like-rate[data-name="'+o+'"]').text(i.data.rate),e(document).find('.js-expert-review-like-activity[data-name="'+o+'"]').text(i.data.activity))}else console.log(i)})).always((function(){a.removeClass("loading"),a.prop("disabled",!1)}))}}))})),jQuery((function(e){var t=new function(){var e="expert_review_polls_v1:"+function(e){var t,i,n,a,s,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=0,l="";do{t=(s=e.charCodeAt(o++)<<16|e.charCodeAt(o++)<<8|e.charCodeAt(o++))>>18&63,i=s>>12&63,n=s>>6&63,a=63&s,l+=r.charAt(t)+r.charAt(i)+r.charAt(n)+r.charAt(a)}while(o<e.length);switch(e.length%3){case 1:l=l.slice(0,-2)+"==";break;case 2:l=l.slice(0,-1)+"="}return l}(window.location.origin),t={votes:{},reset:0};if("undefined"!=typeof localStorage){var i=localStorage.getItem(e);i&&(t=JSON.parse(i))}return{vote:function(e,i){t.votes[e]={a:i,t:Date.now()/1e3|0},n()},getAnswer:function(e){return t.votes.hasOwnProperty(e)?t.votes[e]:null},reset(e,i){void 0!==t.votes[e]&&(t.votes[e].t<i&&delete t.votes[e],n())},resetAll:function(e){if(e&&(!t.reset||t.reset<e)){for(var i in t.reset=e,t.votes)t.votes[i].t<e&&delete t.votes[i];n()}}};function n(){"undefined"!=typeof localStorage&&localStorage.setItem(e,JSON.stringify(t))}},i=function(){e(".js-expert-review-poll").each((function(){var i=e(this);if(!i.data("init")){i.data("init",!0);var n=i.data("id"),a=parseInt(i.data("r"));a&&t.reset(n,a);var s=t.getAnswer(n);s&&(i.addClass("voted"),i.find('.js-expert-review-poll-item[data-id="'+s.a+'"]').addClass("voted"),i.find(".js-expert-review-poll-result-button").hide());var r=i.data("can_vote");void 0===r||r?s||i.find(".js-expert-review-poll-result-button").show():i.addClass("voted")}}))};document.wpshopExpertReview_InitPoll=i,i(),e(document).on("journalx_load_post",(function(){setTimeout(i,100)})),e("body").on("journalx_load_post",i),e(document).on("click",".js-expert-review-poll-item",(function(i){i.preventDefault();var n=e(this),a=n.parents(".js-expert-review-poll"),s=e('<div class="expert-review-poll__loader"><span></span></div>').clone(),r=n.data("can_vote");if(void 0===r||r){if(a.hasClass("voted"))return!1;var o=a.data("id"),l=n.data("id"),p={action:"expert_review_save_poll_vote",nonce:expert_review_ajax.nonce,question:o,answer:l};e.ajax({url:expert_review_ajax.url,type:"post",data:p,beforeSend:function(){a.append(s),n.prop("disabled",!0)}}).done((function(i){i.success?(e('.js-expert-review-poll[data-id="'+o+'"]').each((function(){var t=e(this);t.addClass("voted"),t.find('.js-expert-review-poll-item[data-id="'+l+'"]').addClass("voted")})),t.vote(o,l),e(document.body).trigger("expert_review_poll_voted",[n,a]),a.find(".js-expert-review-poll-result-button").hide(),function(t,i){e('.js-expert-review-poll[data-id="'+t+'"]').each((function(){var t=e(this),n=i.total;for(var a in i.votes){var s=t.find('.js-expert-review-poll-item[data-id="'+a+'"]');if(s.length){var r=Math.round(i.votes[a]/(n||i.votes[a])*100);s.find(".js-expert-review-poll-item-num").text(r+"%"),s.find(".js-expert-review-poll-item-progress").css("width",r+"%")}}var o=t.find(".js-expert-review-poll-count");o.length&&o.text(n)}))}(o,i.data)):console.log(i)})).always((function(){s.remove(),n.prop("disabled",!1)}))}})),e(document).on("click",".js-expert-review-poll-result-button",(function(t){t.preventDefault();var i=e(t.currentTarget),n=i.data("toggle_txt");i.blur(),i.data("toggle_txt",i.text()),i.text(n),i.hasClass("used")?(i.parents(".js-expert-review-poll").removeClass("voted"),i.removeClass("used")):(i.parents(".js-expert-review-poll").addClass("voted"),i.addClass("used"))}))})),jQuery((function(e){var t,i=expert_review_ajax||{},n=i.i18n,a=e('<div class="expert-review-popup__loader"><span></span></div>');e(document).on("click",".js-expert-review-button",(function(t){t.preventDefault();var a=e(this).data("settings");switch(a.type){case"popup":!function(t){if("function"==typeof expert_review_question_popup)return void e("body").append(expert_review_question_popup(n,t));var a=t.use_phone?"        <label>"+n.question_popup_phone+': <input type="text" name="_p" class="required"></label>':"        <label>"+n.question_popup_email+': <input type="text" name="_a" class="required"></label>',s=parseInt(i.consent)?'        <label><input type="checkbox" name="consent" value="1" class="required"> '+n.consent+"</label>":"",r='<div class="expert-review-popup-holder js-expert-review-popup"><div class="expert-review-popup">    <span class="expert-review-popup__close js-expert-review-close-mark">&times;</span>    <div class="expert-review-popup__content">        <form>        <label>'+n.question_popup_name+': <input type="text" name="name" class="required"></label>'+a+'        <input type="hidden" name="email">        <label>'+n.question_popup_question+': <textarea name="text" class="required"></textarea></label>'+s+'        <button type="submit" class="expert-review-popup__submit">'+n.question_popup_submit+'</button>        <span class="expert-review-popup__cancel js-expert-review-cancel">'+n.question_popup_cancel+"</span>"+e('<input type="hidden" name="settings">').val(JSON.stringify(t)).prop("outerHTML")+"        </form>    </div></div></div>";e("body").append(r)}(a);break;case"comments":!function(){if("function"==typeof expert_review_scroll_to_comments)return void expert_review_scroll_to_comments();var t="#comments";i.comment_to_scroll_selector&&(t=i.comment_to_scroll_selector);var n=e(t);n.length&&e("html, body").animate({scrollTop:n.offset().top},200)}();break;case"link":void 0!==a.link&&a.link.length&&(0===a.link.indexOf("#")?window.location.hash=a.link:t.ctrlKey||parseInt(i.ask_question_link_new_tab)?e('<a href="'+a.link+'" target="_blank" rel="noopener"></a>')[0].click():document.location=a.link);break;case"custom":"function"==typeof window.expert_review_custom_ask_question_fn&&expert_review_custom_ask_question_fn(a)}})),e(document).on("click",'.js-expert-review-popup button[type="submit"]',(function(s){s.preventDefault();var r,o=e(this),l=o.parents(".js-expert-review-popup"),p=l.find("form"),d=a.clone(),c=function(e){l.find("form").prepend('<p class="fail-message">'+e+"</p>"),clearTimeout(r),r=setTimeout((function(){l.find(".fail-message").remove()}),5e3)};if(function(i){i.find(".js-expert-review-validation-message").remove();var a=!0;i.find("input.required, textarea.required").each((function(){var t=e(this);t.is(":checkbox")?t.is(":checked")||(a=!1,t.parents("label").append('<p class="js-expert-review-validation-message validation-failed">'+n.field_must_be_checked+"</p>")):t.val().trim()||(a=!1,t.parents("label").append('<p class="js-expert-review-validation-message validation-failed">'+n.field_cannot_be_empty+"</p>"))})),clearTimeout(t),a||(t=setTimeout((function(){i.find(".js-expert-review-validation-message").hide(150,(function(){e(this).remove()}))}),5e3));return a}(p)){var u=function(t){var i=t.serializeArray(),n={};return e.map(i,(function(e,t){n[e.name]=e.value})),n}(l.find("form"));e.ajax({url:i.url,type:"post",data:{action:"expert_review_submit_question",nonce:i.nonce,data:u},beforeSend:function(){o.prop("disabled",!0),l.find(".expert-review-popup").append(d)}}).done((function(e){e.success?(l.find("form").prepend('<p class="success-message">'+n.question_submitted+"</p>"),setTimeout((function(){l.remove()}),3e3),document.dispatchEvent(new CustomEvent("expert_review_question:submit",{detail:{request:u,response:e}}))):e.data&&Array.isArray(e.data)?e.data.reverse().forEach((function(e){var t=e.message;"legacy_form"===e.code&&(console.error(t),t=n.legacy_form),c(t)})):e.data&&e.data.message&&c(e.data.message)})).always((function(){o.prop("disabled",!1),d.remove()}))}})),e(document).on("click",".js-expert-review-cancel, .js-expert-review-close-mark",(function(t){t.preventDefault(),e(this).parents(".js-expert-review-popup").remove()})),e(document).keyup((function(t){27===t.keyCode&&e(".js-expert-review-close-mark").trigger("click")})),e("body").on("click",(function(t){var i=e(t.target);i.is(".js-expert-review-popup")&&!i.find().is(".js-expert-review-popup")&&e(".js-expert-review-close-mark").trigger("click")})),e(document).on("click",".js-expert-review-faq-item-question",(function(t){t.preventDefault();var i=e(this).parent();i.hasClass("expand")?i.removeClass("expand"):i.addClass("expand");e(this).parent().find(".js-expert-review-faq-item-answer").slideToggle()}))}))}));